function getCookie(a){var b=null;if(document.cookie&&""!==document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)===a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}var csrftoken=getCookie("csrftoken");$.ajaxSetup({beforeSend:function(a,b){csrfSafeMethod(b.type)||this.crossDomain||a.setRequestHeader("X-CSRFToken",csrftoken)}}),$(".star").click(function(){var a=$(this),b=$(".global-vote").attr("data-contenttypeid"),c=$(".global-vote").attr("data-objectid"),d=$(".global-vote").attr("data-range"),e=a.data("rating"),f=!1;if("False"==$(".user-vote").attr("data-authenticated")||"None"==$(".user-vote").attr("data-vote")||"0"==$(".user-vote").attr("data-vote"))f=!0;else var g=parseInt($(".user-vote").attr("data-vote"));var h=parseInt($(".global-vote").attr("data-cumulscore")),i=parseInt($(".global-vote").attr("data-votes")),j="/rate/"+b+"/"+c+"/"+e+"/";$.ajax({type:"POST",url:j,success:function(b){if($(".stars .star").removeClass("selected"),a.addClass("selected"),f){var c=(h+e)/(i+1);c=Math.round(c),$(".stars .mstar").removeClass("selected");var j=$(".stars .mstar").eq(d-c);j.addClass("selected"),$(".user-vote").attr("data-vote",e),$(".global-vote").attr("data-votes",i+1),$(".global-vote").attr("data-score",c),$(".global-vote").attr("data-cumulscore",h+e),$(".nb_voter").html(i+1)}else{var c=(h-g+e)/i;c=Math.round(c),$(".stars .mstar").removeClass("selected");var j=$(".stars .mstar").eq(d-c);j.addClass("selected"),$(".user-vote").attr("data-vote",e),$(".global-vote").attr("data-score",c),$(".global-vote").attr("data-cumulscore",h-g+e)}}})});